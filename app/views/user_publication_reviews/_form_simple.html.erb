<% url = @user_publication_review.new_record? ? user_publication_reviews_path(:publication_id => @user_publication_review.publication_id, :mode => 'simple') : user_publication_review_path(@user_publication_review, :mode => 'simple') %>
<% method = @user_publication_review.new_record? ? :post : :put %>
<% form_name = "upr_form_#{@user_publication_review.user_id}" %>

<%= form_tag url, method: method, remote: true, id: form_name, class: 'form-horizontal' do %>
  <div class="well">
    <div class="page-header"><h3>Review Publication</h3></div>

    <div class="control-group">
      <label class="control-label">Approval Status</label>
      <div class="controls radio">
        <% UserPublicationReview::STATUS.each do |display, value| %>
          <%= radio_button :user_publication_review, :status, value, :checked => (@user_publication_review.status == value) %> <label><%= display %></label>
        <% end %>
      </div>
    </div>

    <div class="control-group">
      <%= label :user_publication_review, :comment, class: 'control-label' %>
      <div class="controls">
        <%= text_area :user_publication_review, :comment, rows: 7, style: "width:99%" %>
      </div>
    </div>

    <% if current_user.steering_committee? and ['approved', 'nominated', 'submitted', 'published'].include?(@user_publication_review.publication.status) %>
      <div class="control-group">
        <%= label :user_publication_review, :writing_group_nomination, class: 'control-label' %>
        <div class="controls">
          <%= text_field :user_publication_review, :writing_group_nomination, rows: 3, style: "width:99%", "data-pre" => @user_publication_review.writing_group_nomination.to_s.split(',').collect{|u| {:name => u, id: u}}.to_json %>
        </div>
      </div>
    <% end %>

    <div class="form-actions">
      <%= link_to_function (@user_publication_review.new_record? ? "Submit Review" : "Update Review"), "$('##{form_name}').submit();", class: 'btn btn-primary' %>
      <%= link_to 'Cancel', user_publication_review_path(@user_publication_review, :mode => 'simple'), remote: true, class: 'btn btn-danger' unless @user_publication_review.new_record? %>
    </div>
  </div>
<% end %>

<%= javascript_tag "$('#user_publication_review_writing_group_nomination').tokenInput(root_url + 'users.json',{crossDomain: false, prePopulate: $('#user_publication_review_writing_group_nomination').data('pre'), theme: 'facebook', preventDuplicates: true});" %>
