<% @title = "Publication: #{@publication.full_title}" %>
<h1><%= @title %></h1>
<%= link_to image_tag('icons/edit.png', :alt => '') + "Edit Publication", edit_publication_path(@publication), :class => 'button' if current_user.all_publications.include?(@publication) and ['draft', 'not approved'].include?(@publication.status) %>
<%= link_to image_tag('icons/mydocuments.png', :alt => '') + "View All Publications", publications_path, :class => 'button' %>
<%#= link_to "#{image_tag('icons/eye.png', :alt => '')} View All Publications".html_safe, publications_path, :class => 'button' %>

<div style="clear:both"></div><br />
<table style="border-collapse:collapse;border:0px;margin:0px;padding:0px">
  <tr style="border:0px;margin:0px;padding:0px"><td style="border:0px;margin:0px;padding:0px"><b>Status:</b></td><td style="border:0px;margin:0px;"><%= display_status(@publication.status) %></td><td style="border:0px;margin:0px;"><%= @publication.human_status %></td></tr>
</table>

<%#= link_to 'Edit', edit_publication_path(@publication) %>
<%#= link_to 'Back', publications_path %>
<div style="clear:both"></div>

<% if (current_user.pp_committee? and ['proposed'].include?(@publication.status)) or (current_user.steering_committee? and ['approved'].include?(@publication.status)) %>
<%# if ['proposed', 'approved', 'not approved', 'nominated', 'submitted', 'published'].include?(@publication.status) and (current_user.pp_committee? or current_user.steering_committee?) %>
  <% @user = current_user %>
  <% @user_publication_review = @user.user_publication_reviews.find_by_publication_id(@publication.id) %>
  <% @user_publication_review = @user.user_publication_reviews.new(:publication_id => @publication.id) if @user_publication_review.blank? %>
  <div id="publication_review_box_user_<%= @user.id %>">
    <% if @user_publication_review.status == nil %>
      <%= render :partial => 'user_publication_reviews/form_simple' %>
    <% else %>
      <%= render :partial => 'user_publication_reviews/show_simple' %>
    <% end %>
  </div>
  <div style="clear:both"></div>  
<% end %>

<% if current_user.committee_member? or current_user.secretary? %>
<%= link_to_function "Show/Hide P&P Committee Reviews", "$('#sc_reviews').hide(); $('#pp_reviews').toggle( 'blind', {}, 500 );", :class => 'button' %>
<%= link_to_function "Show/Hide Steering Committee Reviews", "$('#pp_reviews').hide(); $('#sc_reviews').toggle( 'blind', {}, 500 );", :class => 'button' %>
<div style="clear:both"></div>
<fieldset id="pp_reviews" style="display:none">
  <legend>P&amp;P Committee Reviews</legend>
  <table class="blank padded">
    <tbody>
      <% User.current.pp_committee_members.order('last_name, first_name').each do |user| %>
        <% @user = user %>
        <% @user_publication_review = @user.user_publication_reviews.find_by_publication_id(@publication.id) %>
        <% @user_publication_review = @user.user_publication_reviews.new(:publication_id => @publication.id) if @user_publication_review.blank? %>
        <%= render :partial => 'user_publication_reviews/show_small' %>
      <% end %>
    </tbody>
  </table>
</fieldset>
<fieldset id="sc_reviews" style="display:none">
  <legend>Steering Committee Reviews</legend>
  <table class="blank padded">
    <tbody>
      <% User.current.steering_committee_members.order('last_name, first_name').each do |user| %>
        <% @user = user %>
        <% @user_publication_review = @user.user_publication_reviews.find_by_publication_id(@publication.id) %>
        <% @user_publication_review = @user.user_publication_reviews.new(:publication_id => @publication.id) if @user_publication_review.blank? %>
        <%= render :partial => 'user_publication_reviews/show_small' %>
      <% end %>
    </tbody>
  </table>
</fieldset>
<% end %>

<% if ['approved', 'nominated'].include?(@publication.status) and current_user.steering_committee_secretary? %>
  <fieldset style="border: 1px solid #0E7799;">
    <legend>Steering Committee Decision</legend>
    
    <div id="steering_committee_decision_box">
      <% if @publication.status == 'approved' %>
        <%= render :partial => 'publications/edit_steering_committee_decision' %>
      <% else %>
        <%= render :partial => 'publications/show_steering_committee_decision' %>
      <% end %>
    </div>
  </fieldset>
<% end %>

<% if ['proposed', 'not approved', 'approved'].include?(@publication.status) and current_user.pp_committee_secretary? %>
  <fieldset style="border: 1px solid #0E7799;">
    <legend>P&amp;P Committee Decision</legend>
    <div id="subcommittee_decision_box">
      <% if @publication.status == 'proposed' %>
        <%= render :partial => 'publications/edit_subcommittee_decision' %>
      <% else %>
        <%= render :partial => 'publications/show_subcommittee_decision' %>
      <% end %>
    </div>
  </fieldset>
<% end %>


<% if false %>
<% if (current_user.steering_committee? or current_user.steering_committee_secretary?) and ['approved', 'nominated'].include?(@publication.status) %>
  <fieldset>
    <legend>Steering Committee: Publication Reviews</legend>
    <table>
      <tr>
        <th>Committee Member</th>
        <th>Time</th>
        <th>Status</th>
        <th></th>
      </tr>
    <% User.current.steering_committee_members.each do |user| %>
      <% @user = user %>
      <% @user_publication_review = @user.user_publication_reviews.find_by_publication_id(@publication.id) %>
      <tbody id="publication_review_box_user_<%= @user.id %>"><%= render :partial => 'user_publication_reviews/sc_show' %></tbody>
    <% end %>
    </table>
    
    <% if current_user.steering_committee_secretary? %>
      <div id="steering_committee_decision_box">
        <% if @publication.status == 'approved' %>
          <%= render :partial => 'publications/edit_steering_committee_decision' %>
        <% else %>
          <%= render :partial => 'publications/show_steering_committee_decision' %>
        <% end %>
      </div>
    <% end %>
    
  </fieldset>
<% end %>


<% if (current_user.pp_committee? or current_user.pp_committee_secretary?) and ['proposed', 'not approved', 'approved'].include?(@publication.status) %>
  <fieldset>
    <legend>P&amp;P Committee: Publication Reviews</legend>
    <table>
      <tr>
        <th>Committee Member</th>
        <th>Time</th>
        <th>Status</th>
        <th></th>
      </tr>
    <% User.current.pp_committee_members.each do |user| %>
      <% @user = user %>
      <% @user_publication_review = @user.user_publication_reviews.find_by_publication_id(@publication.id) %>
      <tbody id="publication_review_box_user_<%= @user.id %>"><%= render :partial => 'user_publication_reviews/show' %></tbody>
    <% end %>
    </table>
    
    <% if current_user.pp_committee_secretary? %>
      <div id="subcommittee_decision_box">
        <% if @publication.status == 'proposed' %>
          <%= render :partial => 'publications/edit_subcommittee_decision' %>
        <% else %>
          <%= render :partial => 'publications/show_subcommittee_decision' %>
        <% end %>
      </div>
    <% end %>
    
  </fieldset>
<% end %>
<% end %>

<% if ['nominated', 'submitted', 'published'].include?(@publication.status) %>
<fieldset>
  <legend>Manuscript</legend>
  <div id="publication_<%= @publication.id %>_manuscript_container">
    <% if @publication.manuscript_url.blank? and (current_user == @publication.user or current_user.secretary?) %>
      <%= render :partial => 'publications/manuscripts/edit' %>
    <% elsif not @publication.manuscript_url.blank? %>
      <%= render :partial => 'publications/manuscripts/show' %>
    <% else %>
      The author has not uploaded any manuscripts.
    <% end %>
  </div>
</fieldset>
<% end %>


<% if current_user == @publication.user and ['nominated'].include?(@publication.status) %>
<fieldset>
  <legend>Steering Committee Reviewer Comments and Nominations</legend>
  <% @publication.user_publication_reviews.each do |user_publication_review| %>
    <% unless user_publication_review.comment.blank? %><div><%= user_publication_review.comment  %></div><% end %>
    <% unless user_publication_review.writing_group_nomination.blank? %><div>Nomination: <%= user_publication_review.writing_group_nomination %></div><% end %>
  <% end %>
</fieldset>
<% end %>

<% if current_user == @publication.user and ['approved', 'not approved'].include?(@publication.status) %>
<fieldset>
  <legend>Publications and Presentations Sub Committee Reviewer Comments</legend>
  <% @publication.user_publication_reviews.each do |user_publication_review| %>
    <% unless user_publication_review.comment.blank? %><div><pre><%= user_publication_review.comment %></pre></div><% end %>
  <% end %>
</fieldset>
<% end %>

<%= render :partial => 'publications/form', :locals => { :disabled => 'disabled' } %>


<% if false %>
<p>
  <b>Full title:</b>
  <%= @publication.full_title %>
</p>

<p>
  <b>User:</b>
  <%= @publication.user_id %>
</p>

<p>
  <b>Status:</b>
  <%= @publication.status %>
</p>

<p>
  <b>Manuscript Number:</b>
  <%= @publication.manuscript_number %>
</p>

<p>
  <b>Centers:</b>
  <%= @publication.centers %>
</p>

<p>
  <b>Proposal submission date:</b>
  <%= @publication.proposal_submission_date %>
</p>

<p>
  <b>Publication type:</b>
  <%= @publication.publication_type %>
</p>

<p>
  <b>Publication type specify:</b>
  <%= @publication.publication_type_specify %>
</p>

<p>
  <b>Dcc resources none:</b>
  <%= @publication.dcc_resources_none %>
</p>

<p>
  <b>Dcc resources staff:</b>
  <%= @publication.dcc_resources_staff %>
</p>

<p>
  <b>Dcc resources staff specify:</b>
  <%= @publication.dcc_resources_staff_specify %>
</p>

<p>
  <b>Dcc resources other:</b>
  <%= @publication.dcc_resources_other %>
</p>

<p>
  <b>Dcc resources other specify:</b>
  <%= @publication.dcc_resources_other_specify %>
</p>

<p>
  <b>Chat data none:</b>
  <%= @publication.chat_data_none %>
</p>

<p>
  <b>Chat data main forms:</b>
  <%= @publication.chat_data_main_forms %>
</p>

<p>
  <b>Chat data main database:</b>
  <%= @publication.chat_data_main_database %>
</p>

<p>
  <b>Chat data other:</b>
  <%= @publication.chat_data_other %>
</p>

<p>
  <b>Chat data other specify:</b>
  <%= @publication.chat_data_other_specify %>
</p>

<p>
  <b>Manuscript preparation analysis data:</b>
  <%= @publication.manuscript_preparation_analysis_data %>
</p>

<p>
  <b>Manuscript preparation analysis ancillary data:</b>
  <%= @publication.manuscript_preparation_analysis_ancillary_data %>
</p>

<p>
  <b>Manuscript analysis review:</b>
  <%= @publication.manuscript_analysis_review %>
</p>

<p>
  <b>Manuscript preparation other:</b>
  <%= @publication.manuscript_preparation_other %>
</p>

<p>
  <b>Manuscript preparation other specify:</b>
  <%= @publication.manuscript_preparation_other_specify %>
</p>

<p>
  <b>Manuscript preparation none:</b>
  <%= @publication.manuscript_preparation_none %>
</p>

<p>
  <b>Attachment chat form:</b>
  <%= @publication.attachment_chat_form %>
</p>

<p>
  <b>Attachment chat form specify:</b>
  <%= @publication.attachment_chat_form_specify %>
</p>

<p>
  <b>Attachment chat variables:</b>
  <%= @publication.attachment_chat_variables %>
</p>

<p>
  <b>Attachment chat variables specify:</b>
  <%= @publication.attachment_chat_variables_specify %>
</p>

<p>
  <b>Attachment ancillary forms:</b>
  <%= @publication.attachment_ancillary_forms %>
</p>

<p>
  <b>Attachment ancillary forms specify:</b>
  <%= @publication.attachment_ancillary_forms_specify %>
</p>

<p>
  <b>Attachment other:</b>
  <%= @publication.attachment_other %>
</p>

<p>
  <b>Attachment other specify:</b>
  <%= @publication.attachment_other_specify %>
</p>

<p>
  <b>Abbreviated title:</b>
  <%= @publication.abbreviated_title %>
</p>

<p>
  <b>Keywords:</b>
  <%= @publication.keywords %>
</p>

<p>
  <b>Affiliation:</b>
  <%= @publication.affiliation %>
</p>

<p>
  <b>Sponsoring pi:</b>
  <%= @publication.sponsoring_pi %>
</p>

<% if false %>
<p>
  <b>Additional coauthors:</b>
  <%= @publication.additional_coauthors %>
</p>
<% end %>

<p>
  <b>Lead author:</b>
  <%= @publication.lead_author %>
</p>

<p>
  <b>Writing group members:</b>
  <%= @publication.writing_group_members %>
</p>

<p>
  <b>Timeline:</b>
  <%= @publication.timeline %>
</p>

<p>
  <b>Rationale:</b>
  <%= @publication.rationale %>
</p>

<p>
  <b>Hypothesis:</b>
  <%= @publication.hypothesis %>
</p>

<p>
  <b>Data:</b>
  <%= @publication.data %>
</p>

<p>
  <b>Study type:</b>
  <%= @publication.study_type %>
</p>

<p>
  <b>Target journal:</b>
  <%= @publication.target_journal %>
</p>

<p>
  <b>Analysis responsibility:</b>
  <%= @publication.analysis_responsibility %>
</p>

<p>
  <b>Analysis plan:</b>
  <%= @publication.analysis_plan %>
</p>

<p>
  <b>Summary section:</b>
  <%= @publication.summary_section %>
</p>

<p>
  <b>References:</b>
  <%= @publication.references %>
</p>

<p>
  <b>Author assurance:</b>
  <%= @publication.author_assurance %>
</p>

<p>
  <b>Author assurance date:</b>
  <%= @publication.author_assurance_date %>
</p>

<p>
  <b>Approval date:</b>
  <%= @publication.approval_date %>
</p>

<p>
  <b>Committee submission date:</b>
  <%= @publication.committee_submission_date %>
</p>

<% end %>